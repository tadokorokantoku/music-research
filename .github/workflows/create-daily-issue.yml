name: Create Daily MV Annotation Issue

on:
  schedule:
    # ÊØéÊó• JST 23:00 (UTC 14:00) „Å´ÂÆüË°å
    - cron: "0 14 * * *"
  workflow_dispatch: # ÊâãÂãïÂÆüË°å„ÇÇÂèØËÉΩ

permissions:
  contents: read
  issues: write

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get current date (JST)
        id: date
        run: |
          # JST (UTC+9) „Åß‰ªäÊó•„ÅÆÊó•‰ªò„ÇíÂèñÂæó
          DATE=$(TZ=Asia/Tokyo date +%y%m%d)
          echo "date=$DATE" >> $GITHUB_OUTPUT
          echo "üìÖ Creating issue for: $DATE"

      - name: Create issue body
        id: create_body
        run: |
          chmod +x scripts/create_annotation_issue.py
          OUTPUT_FILE=$(python3 scripts/create_annotation_issue.py ${{ steps.date.outputs.date }})
          echo "output_file=$OUTPUT_FILE" >> $GITHUB_OUTPUT

      - name: Create GitHub issue
        if: success()
        run: |
          DATE=${{ steps.date.outputs.date }}
          BODY_FILE=${{ steps.create_body.outputs.output_file }}

          if [ -f "$BODY_FILE" ]; then
            gh issue create \
              --title "üéµ MV Annotation - $DATE" \
              --body-file "$BODY_FILE" \
              --label "mv-annotation,needs-review"
            echo "‚úÖ Issue created successfully"
          else
            echo "‚ö†Ô∏è No issue body found - skipping issue creation"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
